var STComboBox=function(t){var e=function(){},s=function(e){return t("#"+e)},i={up:38,down:40,enter:13,tab:9},o=Date.now||function(){return(new Date).getTime()},n=function(t,e,s){var i,n,l,d,r,c=function(){var h=o()-d;e>h&&h>0?i=setTimeout(c,e-h):(i=null,s||(r=t.apply(l,n),i||(l=n=null)))};return function(){l=this,n=arguments,d=o();var h=s&&!i;return i||(i=setTimeout(c,e)),h&&(r=t.apply(l,n),l=n=null),r}};return e.prototype.Init=function(e){this.containerId=e;var i=s(e);i.html(this.getHtml(e));var o=this;i.find(".stc-button").on("click",function(){o.toggleList(),o.getInput().focus()}),t(document).on("click",function(t){var e=t.target.id;e!=o.getId("ddi")&&e!=o.getId("ddbutton")&&o.hideList()}),this.getInput().on("keydown",function(t){o.onKeyDown(t)}).on("focus",function(t){o.onShowList(t)}).on("click",function(){"none"==o.$("ddl").css("display")&&o.getInput().focus()}).on("blur",function(t){o.onBlur&&o.onBlur(t,o.getInput().val())})},e.prototype.filterAndResetSelected=function(){var t=this.$("ddi").val();return this.deselectRow(),t?(this.$("ddi").val(""),this.restoreAllRows(),this.visibleRows=this.getDomRows(),void(t&&"undefined"!=typeof this.valueMap[t]?this.selectRow(this.valueMap[t],0):this.selectRow(0,0))):void this.selectRow(0,0)},e.prototype.onShowList=function(){this.showList(),this.filterAndResetSelected()},e.prototype.onKeyDown=function(e){if(e.which==i.enter){var s=this.getVisibleDomRows(),o=1*t(s[this.selectedIndex]).attr("data-stc-id");return this.$("ddi").val(this.data[o].text),this.hideList(),this.onSelect&&this.onSelect(e,this.getInput().val()),!1}if(e.which==i.down){var n=this.$("ddl");return"none"==n.css("display")?(this.onShowList(),!1):(this.selectedIndex<this.visibleRows.length-1&&(this.deselectRow(),this.selectRow(++this.selectedIndex,2)),!1)}return e.which==i.up?(e.stopPropagation(),this.selectedIndex>0?(this.deselectRow(),this.selectRow(--this.selectedIndex,1)):this.deselectRow(-1),!1):e.which==i.tab?(this.hideList(),!0):void this.showAndFilterList()},e.prototype.showAndFilterList=n(function(){this.showList(),this.deselectRow(),this.filterList(this.getInput().val()),this.selectRow(0,0)},200),e.prototype.$=function(t){return s(this.containerId+"-"+t)},e.prototype.getId=function(t){return this.containerId+"-"+t},e.prototype.deselectRow=function(t){this.$("ddl").find(".stc-lrow-hl").removeClass("stc-lrow-hl"),t&&(this.selectedIndex=t)},e.prototype.selectRow=function(e,s){var i=this.getVisibleDomRows();if(!(0==i.length||e>=i.length)){t(i[e]).addClass("stc-lrow-hl"),this.selectedIndex=e;var o=this.$("ddl");if(0==e)return void o.scrollTop(0);var n=o.scrollTop(),l=o.height(),d=n+l,r=t(i[e]),c=r.outerHeight(),h=r.position();switch(s){case 0:o.scrollTop(h.top);break;case 1:h.top<n&&o.scrollTop(h.top);break;case 2:h.top+c>d&&o.scrollTop(n+c)}}},e.prototype.restoreAllRows=function(){for(var e=this.getDomRows(),s=0;s<e.length;s++)t(e[s]).show().removeClass("stc-lrow-odd").toggleClass("stc-lrow-odd",s%2==1)},e.prototype.filterList=function(e){for(var s=this.getFilteredRows(e),i=this.getDomRows(),o=0,n=0;o<i.length;o++)t(i[o]).toggle(o in s).removeClass("stc-lrow-odd").toggleClass("stc-lrow-odd",n%2==1),o in s&&n++},e.prototype.getDomRows=function(){return this.$("ddlt")[0].rows},e.prototype.getVisibleDomRows=function(){return this.visibleRows},e.prototype.getFilteredRows=function(t){var e=new RegExp("(\\d+)`([^#]*"+t+"[^#]*)#","gi"),s={},i=null;this.visibleRows=[];for(var o=this.getDomRows();i=e.exec(this.filterCache);){var n=1*i[1];this.visibleRows.push(o[n]),s[n]=0}return s},e.prototype.hideList=function(){this.$("ddl").hide()},e.prototype.showList=function(){var t=this.$("ddt"),e=t.position(),s=t.outerHeight()+e.top,i=2;this.$("ddl").css({top:s+"px",left:e.left,width:this.$("ddb").width()-i+"px"}).show()},e.prototype.toggleList=function(){return this.$("ddl").is(":visible")?void this.hideList():void this.showList()},e.prototype.populateList=function(e){this.data=e,this.filterCache="";for(var s=0;s<e.length;s++)this.filterCache+=s+"`"+e[s].text+"#";var i=this.$("ddl");i.html(this.getListHtml(e));var o=this;i.find(".stc-lrow").hover(function(){t(this).addClass("stc-lrow-hover")},function(){t(this).removeClass("stc-lrow-hover")}).on("click",function(e){var s=1*t(this).attr("data-stc-id");o.getInput().val(o.data[s].text),o.onSelect&&o.onSelect(e,o.getInput().val())}),this.visibleRows=this.getDomRows(),this.selectedIndex=-1},e.prototype.getInput=function(){return this.$("ddi")},e.prototype.getListHtml=function(t){var e=this.containerId,s='<table cellspacing="0" cellpadding="0" class="stc-ltable" id="'+e+'-ddlt">';this.valueMap={};for(var i=0;i<t.length;i++){var o=t[i],n=i%2?"stc-lrow-odd":"";s+='<tr class="stc-lrow '+n+'" data-stc-id="'+o.id+'"><td><span class="stc-text" id="'+e+"-ddtext"+i+'">'+o.text+"</span></td></tr>",this.valueMap[o.text]=i}return s+="</table>"},e.prototype.getHtml=function(t){return'<span class="stc-box" id="'+t+'-ddb"><table cellspacing="0" cellpadding="0" class="stc-table" id="'+t+'-ddt"><tr> <td><input type="text" class="stc-input" id="'+t+'-ddi"/></td> <td class="stc-button" id="'+t+'-ddbutton"></td></tr></table><div id="'+t+'-ddl" class="stc-lc" style="display: none" tabindex="-1"></div></span>'},e}($);